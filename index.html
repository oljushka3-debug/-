<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SmartWallet</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .acc-card { border-radius: 24px; padding: 20px; min-height: 110px; transition: all 0.3s; }
        .trans-card { background: white; border-radius: 18px; padding: 12px; margin-bottom: 8px; display: flex; align-items: center; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
    </style>
</head>
<body class="pb-10">
    <div class="p-6">
        <div class="flex justify-between items-center mb-6">
            <div>
                <p class="text-[10px] font-black uppercase text-slate-400 tracking-widest">–û–±—â–∏–π –∫–∞–ø–∏—Ç–∞–ª</p>
                <h1 id="grandTotal" class="text-3xl font-[900] text-slate-900 tracking-tighter">0.00 ‚Ç¨</h1>
            </div>
            <button onclick="location.reload()" class="w-10 h-10 bg-white rounded-full shadow-sm flex items-center justify-center text-slate-400">
                <i data-lucide="refresh-cw" class="w-5 h-5"></i>
            </button>
        </div>

        <div id="accountsWrapper" class="grid grid-cols-2 gap-3 mb-8">
            </div>

        <div class="bg-white rounded-[32px] p-2 shadow-sm flex mb-8">
            <button class="flex-1 py-3 rounded-[24px] bg-slate-900 text-white text-[11px] font-black uppercase tracking-wider">–ó–∞–ø–∏—Å—å</button>
        </div>

        <div class="flex justify-between items-center mb-4">
            <h3 class="font-black text-slate-800 uppercase text-[11px] tracking-widest">–ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</h3>
        </div>
        <div id="history">
            </div>
    </div>

    <script>
        const GOOGLE_URL = "https://script.google.com/macros/s/AKfycbx7eL499GfK9w31A6T9_tUu7M-w_fK_eU6y9kXy_f7_fL9_f/exec"; // –í–°–¢–ê–í–¨ –°–í–û–Æ –°–°–´–õ–ö–£ –¢–£–¢
        const GEN_RATE = 45; // –ö—É—Ä—Å –¥–ª—è –ø—Ä–∏–º–µ—Ä–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞

        async function loadData() {
            const script = document.createElement('script');
            script.src = GOOGLE_URL + "?callback=renderData";
            document.body.appendChild(script);
        }

        function renderData(rows) {
            if (!rows || rows.length < 2) return;
            let bal = { "Sparkasse": 0, "–ü—Ä–∏–≤–∞—Ç": 0, "–ù–∞–ª–∏—á–Ω—ã–µ EUR": 0, "–ù–∞–ª–∏—á–Ω—ã–µ UAH": 0 };
            let hHTML = "";
            
            // –ò–¥–µ–º —Å –∫–æ–Ω—Ü–∞ —Ç–∞–±–ª–∏—Ü—ã –∫ –Ω–∞—á–∞–ª—É (i=rows.length-1), —á—Ç–æ–±—ã –Ω–æ–≤—ã–µ –±—ã–ª–∏ —Å–≤–µ—Ä—Ö—É
            for (let i = rows.length - 1; i >= 1; i--) {
                const r = rows[i];
                if (!r[6] || r[6] === "") continue;

                const shop = r[1] || "–ó–∞–ø–∏—Å—å";
                const itemRU = r[3] || "";
                const amt = parseFloat(r[6]) || 0;
                const curr = r[7] || "EUR";
                const cat = r[8] || "";
                const acc = r[9] || "Sparkasse";

                const isInc = cat.includes("üíé") || cat.includes("–î–æ—Ö–æ–¥") || cat.includes("–≤ ");

                if (bal.hasOwnProperty(acc)) {
                    bal[acc] += isInc ? amt : -amt;
                }

                hHTML += `
                <div class="trans-card">
                    <div class="w-9 h-9 ${isInc ? 'bg-emerald-50 text-emerald-500' : 'bg-rose-50 text-rose-500'} rounded-xl flex items-center justify-center mr-3 shrink-0">
                        <i data-lucide="${isInc ? 'arrow-up-right' : 'shopping-bag'}" class="w-4 h-4"></i>
                    </div>
                    <div class="flex-1">
                        <h4 class="text-[11px] font-black uppercase text-slate-800">${shop}</h4>
                        <p class="text-[8px] font-bold text-slate-400 uppercase">${itemRU || acc}</p>
                    </div>
                    <div class="text-right">
                        <p class="text-[12px] font-black ${isInc ? 'text-emerald-500' : 'text-rose-500'}">
                            ${isInc ? '+' : '-'}${amt.toFixed(2)} ${curr === 'EUR' ? '‚Ç¨' : '‚Ç¥'}
                        </p>
                    </div>
                </div>`;
            }

            const accs = [
                {n:'Sparkasse', v:bal.Sparkasse, c:'‚Ç¨', cl:'bg-indigo-600'},
                {n:'–ü—Ä–∏–≤–∞—Ç', v:bal.–ü—Ä–∏–≤–∞—Ç, c:'‚Ç¥', cl:'bg-violet-600', s:true},
                {n:'–ù–∞–ª EUR', v:bal["–ù–∞–ª–∏—á–Ω—ã–µ EUR"], c:'‚Ç¨', cl:'bg-emerald-600'},
                {n:'–ù–∞–ª UAH', v:bal["–ù–∞–ª–∏—á–Ω—ã–µ UAH"], c:'‚Ç¥', cl:'bg-slate-800', s:true}
            ];
            
            document.getElementById('accountsWrapper').innerHTML = accs.map(a => `
                <div class="${a.cl} acc-card text-white">
                    <p class="text-[8px] font-black uppercase opacity-60 mb-1">${a.n}</p>
                    <p class="text-lg font-black tracking-tighter">${a.v.toFixed(2)}${a.c}</p>
                </div>`).join('');

            document.getElementById('grandTotal').innerText = (bal.Sparkasse + bal["–ù–∞–ª–∏—á–Ω—ã–µ EUR"] + (bal.–ü—Ä–∏–≤–∞—Ç + bal["–ù–∞–ª–∏—á–Ω—ã–µ UAH"])/GEN_RATE).toFixed(2) + " ‚Ç¨";
            document.getElementById('history').innerHTML = hHTML;
            lucide.createIcons();
        }

        window.onload = loadData;
    </script>
</body>
</html>
