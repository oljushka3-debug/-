<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SmartWallet v7.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-slate-100 font-sans p-4">

    <div class="bg-slate-800 p-6 rounded-[32px] shadow-2xl mb-6 border border-slate-700/50">
        <div class="flex justify-between items-center mb-4">
            <span class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]">–ö—É—Ä—Å ‚Ç¨</span>
            <input type="number" id="rate" value="50.76" step="0.01" oninput="calc()" class="w-20 bg-slate-700/50 rounded-xl py-1 px-2 text-center text-yellow-400 font-bold outline-none border border-yellow-500/20 focus:border-yellow-500/50 transition-all">
        </div>
        <div class="text-center py-2">
            <p class="text-[10px] text-slate-500 uppercase font-bold tracking-widest mb-1">–ö–∞–ø–∏—Ç–∞–ª (EUR)</p>
            <h1 id="mainBalance" class="text-4xl font-black text-white tracking-tighter italic">‚Ç¨ 0.00</h1>
        </div>
    </div>

    <button onclick="openModal()" class="w-full bg-gradient-to-br from-rose-500 to-rose-700 py-5 rounded-[24px] font-black text-lg shadow-[0_10px_20px_rgba(244,63,94,0.3)] active:scale-95 transition-all mb-8 uppercase tracking-widest border-b-4 border-rose-900">
        –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥
    </button>

    <div id="history" class="space-y-3"></div>

    <div id="modal" class="fixed inset-0 bg-slate-950/90 backdrop-blur-md hidden flex items-center justify-center p-4 z-50">
        <div class="bg-slate-800 w-full max-w-sm rounded-[40px] p-8 border border-slate-700 shadow-2xl relative">
            <button onclick="closeModal()" class="absolute top-6 right-6 text-slate-500 text-3xl hover:text-white">&times;</button>
            <h2 class="text-2xl font-black mb-8 italic text-yellow-400 tracking-tight underline decoration-yellow-500/30 underline-offset-8">–ù–û–í–´–ô –ß–ï–ö</h2>
            
            <div class="space-y-5">
                <input type="date" id="date" class="w-full bg-slate-900/50 border border-slate-700 rounded-2xl p-4 font-bold outline-none focus:border-yellow-500/50 text-white">
                
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-slate-900/50 p-4 rounded-3xl border border-slate-700">
                        <label class="text-[10px] text-slate-500 block uppercase font-black mb-2">–ö–æ–ª-–≤–æ</label>
                        <input type="number" id="qty" value="1" oninput="calc()" class="w-full bg-transparent text-2xl font-black text-white outline-none">
                    </div>
                    <div class="bg-slate-900/50 p-4 rounded-3xl border border-slate-700">
                        <label class="text-[10px] text-blue-400 block uppercase font-black mb-2 italic text-center">–¶–µ–Ω–∞ ‚Ç¨</label>
                        <input type="number" id="price" placeholder="0.00" oninput="calc()" class="w-full bg-transparent text-2xl font-black text-white outline-none text-center">
                    </div>
                </div>

                <div id="infoBox" class="bg-yellow-500/5 border border-yellow-500/20 p-5 rounded-3xl text-center hidden animate-pulse">
                    <p class="text-[10px] text-yellow-600 uppercase font-black tracking-widest mb-1">–°–ø–∏—Å–∞–Ω–∏–µ —Å –ü—Ä–∏–≤–∞—Ç–∞:</p>
                    <p id="uahResult" class="text-3xl font-black text-yellow-500 tracking-tighter">0.00 ‚Ç¥</p>
                </div>

                <div class="space-y-2">
                    <input type="text" id="merchant" placeholder="–ú–∞–≥–∞–∑–∏–Ω (Rewe, Lidl...)" class="w-full bg-slate-900/50 border border-slate-700 rounded-2xl p-4 outline-none focus:border-yellow-500/50 font-bold">
                    <div class="grid grid-cols-2 gap-2">
                        <input type="text" id="itemDE" placeholder="–¢–æ–≤–∞—Ä DE" class="bg-slate-900/50 border border-slate-700 rounded-2xl p-4 text-sm outline-none">
                        <input type="text" id="itemRU" placeholder="–¢–æ–≤–∞—Ä RU" class="bg-slate-900/50 border border-slate-700 rounded-2xl p-4 text-sm outline-none">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <select id="acc" onchange="calc()" class="bg-slate-900/50 border border-slate-700 rounded-2xl p-4 font-bold outline-none text-slate-300">
                        <option value="Sparkasse">Sparkasse</option>
                        <option value="–ü—Ä–∏–≤–∞—Ç">–ü—Ä–∏–≤–∞—Ç</option>
                        <option value="Cash EUR">–ù–∞–ª ‚Ç¨</option>
                        <option value="Cash UAH">–ù–∞–ª ‚Ç¥</option>
                    </select>
                    <select id="cat" class="bg-slate-900/50 border border-slate-700 rounded-2xl p-4 font-bold outline-none text-slate-300">
                        <option>üçé –ü—Ä–æ–¥—É–∫—Ç—ã</option>
                        <option>üè† –î–æ–º</option>
                        <option>üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option>
                        <option>üç∑ –ê–ª–∫–æ–≥–æ–ª—å</option>
                        <option>üì¶ –ü—Ä–æ—á–µ–µ</option>
                    </select>
                </div>

                <button id="saveBtn" onclick="save()" class="w-full bg-yellow-500 text-slate-950 py-5 rounded-[24px] font-black text-xl shadow-lg active:scale-95 transition-all uppercase tracking-tighter">
                    –ó–∞–ø–∏—Å–∞—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É
                </button>
            </div>
        </div>
    </div>

    <script>
        // –¢–í–û–Ø –°–°–´–õ–ö–ê –ò–ó –ì–£–ì–õ –°–ö–†–ò–ü–¢–ê (–®–ê–ì 2)
        const API_URL = "<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SmartWallet v7.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-slate-100 font-sans p-4">

    <div class="bg-slate-800 p-6 rounded-[32px] shadow-2xl mb-6 border border-slate-700/50">
        <div class="flex justify-between items-center mb-4">
            <span class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]">–ö—É—Ä—Å ‚Ç¨</span>
            <input type="number" id="rate" value="50.76" step="0.01" oninput="calc()" class="w-20 bg-slate-700/50 rounded-xl py-1 px-2 text-center text-yellow-400 font-bold outline-none border border-yellow-500/20 focus:border-yellow-500/50 transition-all">
        </div>
        <div class="text-center py-2">
            <p class="text-[10px] text-slate-500 uppercase font-bold tracking-widest mb-1">–ö–∞–ø–∏—Ç–∞–ª (EUR)</p>
            <h1 id="mainBalance" class="text-4xl font-black text-white tracking-tighter italic">‚Ç¨ 0.00</h1>
        </div>
    </div>

    <button onclick="openModal()" class="w-full bg-gradient-to-br from-rose-500 to-rose-700 py-5 rounded-[24px] font-black text-lg shadow-[0_10px_20px_rgba(244,63,94,0.3)] active:scale-95 transition-all mb-8 uppercase tracking-widest border-b-4 border-rose-900">
        –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥
    </button>

    <div id="history" class="space-y-3"></div>

    <div id="modal" class="fixed inset-0 bg-slate-950/90 backdrop-blur-md hidden flex items-center justify-center p-4 z-50">
        <div class="bg-slate-800 w-full max-w-sm rounded-[40px] p-8 border border-slate-700 shadow-2xl relative">
            <button onclick="closeModal()" class="absolute top-6 right-6 text-slate-500 text-3xl hover:text-white">&times;</button>
            <h2 class="text-2xl font-black mb-8 italic text-yellow-400 tracking-tight underline decoration-yellow-500/30 underline-offset-8">–ù–û–í–´–ô –ß–ï–ö</h2>
            
            <div class="space-y-5">
                <input type="date" id="date" class="w-full bg-slate-900/50 border border-slate-700 rounded-2xl p-4 font-bold outline-none focus:border-yellow-500/50 text-white">
                
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-slate-900/50 p-4 rounded-3xl border border-slate-700">
                        <label class="text-[10px] text-slate-500 block uppercase font-black mb-2">–ö–æ–ª-–≤–æ</label>
                        <input type="number" id="qty" value="1" oninput="calc()" class="w-full bg-transparent text-2xl font-black text-white outline-none">
                    </div>
                    <div class="bg-slate-900/50 p-4 rounded-3xl border border-slate-700">
                        <label class="text-[10px] text-blue-400 block uppercase font-black mb-2 italic text-center">–¶–µ–Ω–∞ ‚Ç¨</label>
                        <input type="number" id="price" placeholder="0.00" oninput="calc()" class="w-full bg-transparent text-2xl font-black text-white outline-none text-center">
                    </div>
                </div>

                <div id="infoBox" class="bg-yellow-500/5 border border-yellow-500/20 p-5 rounded-3xl text-center hidden animate-pulse">
                    <p class="text-[10px] text-yellow-600 uppercase font-black tracking-widest mb-1">–°–ø–∏—Å–∞–Ω–∏–µ —Å –ü—Ä–∏–≤–∞—Ç–∞:</p>
                    <p id="uahResult" class="text-3xl font-black text-yellow-500 tracking-tighter">0.00 ‚Ç¥</p>
                </div>

                <div class="space-y-2">
                    <input type="text" id="merchant" placeholder="–ú–∞–≥–∞–∑–∏–Ω (Rewe, Lidl...)" class="w-full bg-slate-900/50 border border-slate-700 rounded-2xl p-4 outline-none focus:border-yellow-500/50 font-bold">
                    <div class="grid grid-cols-2 gap-2">
                        <input type="text" id="itemDE" placeholder="–¢–æ–≤–∞—Ä DE" class="bg-slate-900/50 border border-slate-700 rounded-2xl p-4 text-sm outline-none">
                        <input type="text" id="itemRU" placeholder="–¢–æ–≤–∞—Ä RU" class="bg-slate-900/50 border border-slate-700 rounded-2xl p-4 text-sm outline-none">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <select id="acc" onchange="calc()" class="bg-slate-900/50 border border-slate-700 rounded-2xl p-4 font-bold outline-none text-slate-300">
                        <option value="Sparkasse">Sparkasse</option>
                        <option value="–ü—Ä–∏–≤–∞—Ç">–ü—Ä–∏–≤–∞—Ç</option>
                        <option value="Cash EUR">–ù–∞–ª ‚Ç¨</option>
                        <option value="Cash UAH">–ù–∞–ª ‚Ç¥</option>
                    </select>
                    <select id="cat" class="bg-slate-900/50 border border-slate-700 rounded-2xl p-4 font-bold outline-none text-slate-300">
                        <option>üçé –ü—Ä–æ–¥—É–∫—Ç—ã</option>
                        <option>üè† –î–æ–º</option>
                        <option>üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option>
                        <option>üç∑ –ê–ª–∫–æ–≥–æ–ª—å</option>
                        <option>üì¶ –ü—Ä–æ—á–µ–µ</option>
                    </select>
                </div>

                <button id="saveBtn" onclick="save()" class="w-full bg-yellow-500 text-slate-950 py-5 rounded-[24px] font-black text-xl shadow-lg active:scale-95 transition-all uppercase tracking-tighter">
                    –ó–∞–ø–∏—Å–∞—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É
                </button>
            </div>
        </div>
    </div>

    <script>
        // –¢–í–û–Ø –°–°–´–õ–ö–ê –ò–ó –ì–£–ì–õ –°–ö–†–ò–ü–¢–ê (–®–ê–ì 2)
        const API_URL = "<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SmartWallet v7.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-slate-100 font-sans p-4">

    <div class="bg-slate-800 p-6 rounded-[32px] shadow-2xl mb-6 border border-slate-700/50">
        <div class="flex justify-between items-center mb-4">
            <span class="text-[10px] font-black text-slate-400 uppercase tracking-[0.2em]">–ö—É—Ä—Å ‚Ç¨</span>
            <input type="number" id="rate" value="50.76" step="0.01" oninput="calc()" class="w-20 bg-slate-700/50 rounded-xl py-1 px-2 text-center text-yellow-400 font-bold outline-none border border-yellow-500/20 focus:border-yellow-500/50 transition-all">
        </div>
        <div class="text-center py-2">
            <p class="text-[10px] text-slate-500 uppercase font-bold tracking-widest mb-1">–ö–∞–ø–∏—Ç–∞–ª (EUR)</p>
            <h1 id="mainBalance" class="text-4xl font-black text-white tracking-tighter italic">‚Ç¨ 0.00</h1>
        </div>
    </div>

    <button onclick="openModal()" class="w-full bg-gradient-to-br from-rose-500 to-rose-700 py-5 rounded-[24px] font-black text-lg shadow-[0_10px_20px_rgba(244,63,94,0.3)] active:scale-95 transition-all mb-8 uppercase tracking-widest border-b-4 border-rose-900">
        –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥
    </button>

    <div id="history" class="space-y-3"></div>

    <div id="modal" class="fixed inset-0 bg-slate-950/90 backdrop-blur-md hidden flex items-center justify-center p-4 z-50">
        <div class="bg-slate-800 w-full max-w-sm rounded-[40px] p-8 border border-slate-700 shadow-2xl relative">
            <button onclick="closeModal()" class="absolute top-6 right-6 text-slate-500 text-3xl hover:text-white">&times;</button>
            <h2 class="text-2xl font-black mb-8 italic text-yellow-400 tracking-tight underline decoration-yellow-500/30 underline-offset-8">–ù–û–í–´–ô –ß–ï–ö</h2>
            
            <div class="space-y-5">
                <input type="date" id="date" class="w-full bg-slate-900/50 border border-slate-700 rounded-2xl p-4 font-bold outline-none focus:border-yellow-500/50 text-white">
                
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-slate-900/50 p-4 rounded-3xl border border-slate-700">
                        <label class="text-[10px] text-slate-500 block uppercase font-black mb-2">–ö–æ–ª-–≤–æ</label>
                        <input type="number" id="qty" value="1" oninput="calc()" class="w-full bg-transparent text-2xl font-black text-white outline-none">
                    </div>
                    <div class="bg-slate-900/50 p-4 rounded-3xl border border-slate-700">
                        <label class="text-[10px] text-blue-400 block uppercase font-black mb-2 italic text-center">–¶–µ–Ω–∞ ‚Ç¨</label>
                        <input type="number" id="price" placeholder="0.00" oninput="calc()" class="w-full bg-transparent text-2xl font-black text-white outline-none text-center">
                    </div>
                </div>

                <div id="infoBox" class="bg-yellow-500/5 border border-yellow-500/20 p-5 rounded-3xl text-center hidden animate-pulse">
                    <p class="text-[10px] text-yellow-600 uppercase font-black tracking-widest mb-1">–°–ø–∏—Å–∞–Ω–∏–µ —Å –ü—Ä–∏–≤–∞—Ç–∞:</p>
                    <p id="uahResult" class="text-3xl font-black text-yellow-500 tracking-tighter">0.00 ‚Ç¥</p>
                </div>

                <div class="space-y-2">
                    <input type="text" id="merchant" placeholder="–ú–∞–≥–∞–∑–∏–Ω (Rewe, Lidl...)" class="w-full bg-slate-900/50 border border-slate-700 rounded-2xl p-4 outline-none focus:border-yellow-500/50 font-bold">
                    <div class="grid grid-cols-2 gap-2">
                        <input type="text" id="itemDE" placeholder="–¢–æ–≤–∞—Ä DE" class="bg-slate-900/50 border border-slate-700 rounded-2xl p-4 text-sm outline-none">
                        <input type="text" id="itemRU" placeholder="–¢–æ–≤–∞—Ä RU" class="bg-slate-900/50 border border-slate-700 rounded-2xl p-4 text-sm outline-none">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-3">
                    <select id="acc" onchange="calc()" class="bg-slate-900/50 border border-slate-700 rounded-2xl p-4 font-bold outline-none text-slate-300">
                        <option value="Sparkasse">Sparkasse</option>
                        <option value="–ü—Ä–∏–≤–∞—Ç">–ü—Ä–∏–≤–∞—Ç</option>
                        <option value="Cash EUR">–ù–∞–ª ‚Ç¨</option>
                        <option value="Cash UAH">–ù–∞–ª ‚Ç¥</option>
                    </select>
                    <select id="cat" class="bg-slate-900/50 border border-slate-700 rounded-2xl p-4 font-bold outline-none text-slate-300">
                        <option>üçé –ü—Ä–æ–¥—É–∫—Ç—ã</option>
                        <option>üè† –î–æ–º</option>
                        <option>üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option>
                        <option>üç∑ –ê–ª–∫–æ–≥–æ–ª—å</option>
                        <option>üì¶ –ü—Ä–æ—á–µ–µ</option>
                    </select>
                </div>

                <button id="saveBtn" onclick="save()" class="w-full bg-yellow-500 text-slate-950 py-5 rounded-[24px] font-black text-xl shadow-lg active:scale-95 transition-all uppercase tracking-tighter">
                    –ó–∞–ø–∏—Å–∞—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É
                </button>
            </div>
        </div>
    </div>

    <script>
        // –¢–í–û–Ø –°–°–´–õ–ö–ê –ò–ó –ì–£–ì–õ –°–ö–†–ò–ü–¢–ê (–®–ê–ì 2)
        const API_URL = "https://script.google.com/macros/s/AKfycbxEnssB37LRmWIaitZc0kLb1l0vMuiQQReskfE0bSurqTdt1HiuaDKT9WXirfPjlqrp/exec";

        function calc() {
            const q = parseFloat(document.getElementById('qty').value) || 0;
            const p = parseFloat(document.getElementById('price').value) || 0;
            const r = parseFloat(document.getElementById('rate').value) || 0;
            const acc = document.getElementById('acc').value;
            const uah = (q * p * r).toFixed(2);
            
            const info = document.getElementById('infoBox');
            if (acc === '–ü—Ä–∏–≤–∞—Ç' && q > 0 && p > 0) {
                info.classList.remove('hidden');
                document.getElementById('uahResult').innerText = uah + ' ‚Ç¥';
            } else {
                info.classList.add('hidden');
            }
        }

        function openModal() {
            document.getElementById('modal').classList.remove('hidden');
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
        }

        function closeModal() { document.getElementById('modal').classList.add('hidden'); }

        async function save() {
            const btn = document.getElementById('saveBtn');
            const q = document.getElementById('qty').value;
            const p = document.getElementById('price').value;
            const acc = document.getElementById('acc').value;
            const rate = document.getElementById('rate').value;
            const uahValue = (q * p * rate).toFixed(2);
            
            const payload = {
                action: 'add',
                date: document.getElementById('date').value,
                category: document.getElementById('cat').value,
                merchant: document.getElementById('merchant').value || '‚Äî',
                itemDE: document.getElementById('itemDE').value || '‚Äî',
                itemRU: document.getElementById('itemRU').value || '‚Äî',
                account: acc,
                qty: q,
                priceUnit: p,
                totalTran: (q * p).toFixed(2),
                curTran: "EUR",
                totalCard: (acc === '–ü—Ä–∏–≤–∞—Ç') ? '-' + uahValue : "",
                curCard: (acc === '–ü—Ä–∏–≤–∞—Ç') ? "UAH" : "",
                rate: rate
            };

            btn.innerText = "‚è≥ –°–û–•–†–ê–ù–ï–ù–ò–ï...";
            btn.disabled = true;
            try {
                await fetch(API_URL, { method: 'POST', body: JSON.stringify(payload) });
                location.reload();
            } catch (e) {
                alert("–û—à–∏–±–∫–∞! –ü—Ä–æ–≤–µ—Ä—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏–ª–∏ —Å—Å—ã–ª–∫—É.");
                btn.disabled = false;
                btn.innerText = "–ó–∞–ø–∏—Å–∞—Ç—å";
            }
        }

        async function load() {
            const script = document.createElement('script');
            script.src = `${API_URL}?callback=draw&t=${Date.now()}`;
            document.body.appendChild(script);
        }

        function draw(data) {
            const hist = document.getElementById('history');
            let total = 0;
            if(!data.rows) return;
            data.rows.slice(-10).reverse().forEach(r => {
                const sumEur = parseFloat(r[8]) || 0;
                const acc = r[5];
                hist.innerHTML += `
                    <div class="bg-slate-800/50 p-4 rounded-3xl flex justify-between items-center border border-slate-700/50 mb-2">
                        <div>
                            <p class="text-[10px] text-slate-500 font-bold">${r[0].split('T')[0].substring(5)} | ${r[1]}</p>
                            <p class="font-bold text-slate-200">${r[2]}</p>
                            <p class="text-[9px] text-slate-500 uppercase tracking-tighter">${acc}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-black text-rose-500">-${sumEur.toFixed(2)} ‚Ç¨</p>
                            ${r[10] ? `<p class="text-[10px] text-yellow-500 font-bold italic">${r[10]} ‚Ç¥</p>` : ''}
                        </div>
                    </div>`;
            });
        }
        window.onload = load;
    </script>
</body>
</html>";

        function calc() {
            const q = parseFloat(document.getElementById('qty').value) || 0;
            const p = parseFloat(document.getElementById('price').value) || 0;
            const r = parseFloat(document.getElementById('rate').value) || 0;
            const acc = document.getElementById('acc').value;
            const uah = (q * p * r).toFixed(2);
            
            const info = document.getElementById('infoBox');
            if (acc === '–ü—Ä–∏–≤–∞—Ç' && q > 0 && p > 0) {
                info.classList.remove('hidden');
                document.getElementById('uahResult').innerText = uah + ' ‚Ç¥';
            } else {
                info.classList.add('hidden');
            }
        }

        function openModal() {
            document.getElementById('modal').classList.remove('hidden');
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
        }

        function closeModal() { document.getElementById('modal').classList.add('hidden'); }

        async function save() {
            const btn = document.getElementById('saveBtn');
            const q = document.getElementById('qty').value;
            const p = document.getElementById('price').value;
            const acc = document.getElementById('acc').value;
            const rate = document.getElementById('rate').value;
            const uahValue = (q * p * rate).toFixed(2);
            
            const payload = {
                action: 'add',
                date: document.getElementById('date').value,
                category: document.getElementById('cat').value,
                merchant: document.getElementById('merchant').value || '‚Äî',
                itemDE: document.getElementById('itemDE').value || '‚Äî',
                itemRU: document.getElementById('itemRU').value || '‚Äî',
                account: acc,
                qty: q,
                priceUnit: p,
                totalTran: (q * p).toFixed(2),
                curTran: "EUR",
                totalCard: (acc === '–ü—Ä–∏–≤–∞—Ç') ? '-' + uahValue : "",
                curCard: (acc === '–ü—Ä–∏–≤–∞—Ç') ? "UAH" : "",
                rate: rate
            };

            btn.innerText = "‚è≥ –°–û–•–†–ê–ù–ï–ù–ò–ï...";
            btn.disabled = true;
            try {
                await fetch(API_URL, { method: 'POST', body: JSON.stringify(payload) });
                location.reload();
            } catch (e) {
                alert("–û—à–∏–±–∫–∞! –ü—Ä–æ–≤–µ—Ä—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏–ª–∏ —Å—Å—ã–ª–∫—É.");
                btn.disabled = false;
                btn.innerText = "–ó–∞–ø–∏—Å–∞—Ç—å";
            }
        }

        async function load() {
            const script = document.createElement('script');
            script.src = `${API_URL}?callback=draw&t=${Date.now()}`;
            document.body.appendChild(script);
        }

        function draw(data) {
            const hist = document.getElementById('history');
            let total = 0;
            if(!data.rows) return;
            data.rows.slice(-10).reverse().forEach(r => {
                const sumEur = parseFloat(r[8]) || 0;
                const acc = r[5];
                hist.innerHTML += `
                    <div class="bg-slate-800/50 p-4 rounded-3xl flex justify-between items-center border border-slate-700/50 mb-2">
                        <div>
                            <p class="text-[10px] text-slate-500 font-bold">${r[0].split('T')[0].substring(5)} | ${r[1]}</p>
                            <p class="font-bold text-slate-200">${r[2]}</p>
                            <p class="text-[9px] text-slate-500 uppercase tracking-tighter">${acc}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-black text-rose-500">-${sumEur.toFixed(2)} ‚Ç¨</p>
                            ${r[10] ? `<p class="text-[10px] text-yellow-500 font-bold italic">${r[10]} ‚Ç¥</p>` : ''}
                        </div>
                    </div>`;
            });
        }
        window.onload = load;
    </script>
</body>
</html>";

        function calc() {
            const q = parseFloat(document.getElementById('qty').value) || 0;
            const p = parseFloat(document.getElementById('price').value) || 0;
            const r = parseFloat(document.getElementById('rate').value) || 0;
            const acc = document.getElementById('acc').value;
            const uah = (q * p * r).toFixed(2);
            
            const info = document.getElementById('infoBox');
            if (acc === '–ü—Ä–∏–≤–∞—Ç' && q > 0 && p > 0) {
                info.classList.remove('hidden');
                document.getElementById('uahResult').innerText = uah + ' ‚Ç¥';
            } else {
                info.classList.add('hidden');
            }
        }

        function openModal() {
            document.getElementById('modal').classList.remove('hidden');
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
        }

        function closeModal() { document.getElementById('modal').classList.add('hidden'); }

        async function save() {
            const btn = document.getElementById('saveBtn');
            const q = document.getElementById('qty').value;
            const p = document.getElementById('price').value;
            const acc = document.getElementById('acc').value;
            const rate = document.getElementById('rate').value;
            const uahValue = (q * p * rate).toFixed(2);
            
            const payload = {
                action: 'add',
                date: document.getElementById('date').value,
                category: document.getElementById('cat').value,
                merchant: document.getElementById('merchant').value || '‚Äî',
                itemDE: document.getElementById('itemDE').value || '‚Äî',
                itemRU: document.getElementById('itemRU').value || '‚Äî',
                account: acc,
                qty: q,
                priceUnit: p,
                totalTran: (q * p).toFixed(2),
                curTran: "EUR",
                totalCard: (acc === '–ü—Ä–∏–≤–∞—Ç') ? '-' + uahValue : "",
                curCard: (acc === '–ü—Ä–∏–≤–∞—Ç') ? "UAH" : "",
                rate: rate
            };

            btn.innerText = "‚è≥ –°–û–•–†–ê–ù–ï–ù–ò–ï...";
            btn.disabled = true;
            try {
                await fetch(API_URL, { method: 'POST', body: JSON.stringify(payload) });
                location.reload();
            } catch (e) {
                alert("–û—à–∏–±–∫–∞! –ü—Ä–æ–≤–µ—Ä—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∏–ª–∏ —Å—Å—ã–ª–∫—É.");
                btn.disabled = false;
                btn.innerText = "–ó–∞–ø–∏—Å–∞—Ç—å";
            }
        }

        async function load() {
            const script = document.createElement('script');
            script.src = `${API_URL}?callback=draw&t=${Date.now()}`;
            document.body.appendChild(script);
        }

        function draw(data) {
            const hist = document.getElementById('history');
            let total = 0;
            if(!data.rows) return;
            data.rows.slice(-10).reverse().forEach(r => {
                const sumEur = parseFloat(r[8]) || 0;
                const acc = r[5];
                hist.innerHTML += `
                    <div class="bg-slate-800/50 p-4 rounded-3xl flex justify-between items-center border border-slate-700/50 mb-2">
                        <div>
                            <p class="text-[10px] text-slate-500 font-bold">${r[0].split('T')[0].substring(5)} | ${r[1]}</p>
                            <p class="font-bold text-slate-200">${r[2]}</p>
                            <p class="text-[9px] text-slate-500 uppercase tracking-tighter">${acc}</p>
                        </div>
                        <div class="text-right">
                            <p class="font-black text-rose-500">-${sumEur.toFixed(2)} ‚Ç¨</p>
                            ${r[10] ? `<p class="text-[10px] text-yellow-500 font-bold italic">${r[10]} ‚Ç¥</p>` : ''}
                        </div>
                    </div>`;
            });
        }
        window.onload = load;
    </script>
</body>
</html>
