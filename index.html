<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Smart Wallet Pro 2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900 pb-10">
    <div class="max-w-md mx-auto p-4">
        <div id="rates-header" class="text-center text-[10px] font-bold text-blue-500 mb-4 uppercase tracking-tighter italic">–ó–∞–≥—Ä—É–∑–∫–∞ –∫—É—Ä—Å–∞...</div>
        
        <div class="bg-blue-700 rounded-[32px] p-6 text-white shadow-xl mb-6 text-center">
            <p class="text-[10px] uppercase font-bold opacity-70 mb-1">–í—Å–µ–≥–æ –≤ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–µ EUR</p>
            <div id="total-val" class="text-4xl font-black italic tracking-tighter">0.00 ‚Ç¨</div>
        </div>

        <div id="balance-grid" class="grid grid-cols-2 gap-3 mb-6"></div>

        <div class="bg-white p-6 rounded-[32px] shadow-xl border border-slate-100 mb-8">
            <div class="flex gap-2 mb-4 bg-slate-100 p-1 rounded-2xl">
                <button onclick="window.mode='expense';render()" id="m-exp" class="flex-1 py-2 rounded-xl text-[10px] font-bold uppercase bg-white shadow-sm">–†–∞—Å—Ö–æ–¥</button>
                <button onclick="window.mode='income';render()" id="m-inc" class="flex-1 py-2 rounded-xl text-[10px] font-bold uppercase text-slate-400">–î–æ—Ö–æ–¥</button>
                <button onclick="window.mode='transfer';render()" id="m-tra" class="flex-1 py-2 rounded-xl text-[10px] font-bold uppercase text-slate-400">–ü–µ—Ä–µ–≤–æ–¥</button>
            </div>
            <input id="sum" type="number" placeholder="0.00" class="w-full text-5xl font-black text-center outline-none mb-4">
            <div id="acc-box" class="space-y-2 mb-4">
                <select id="acc1" class="w-full p-3 bg-slate-50 rounded-xl font-bold text-center border text-sm"></select>
                <div id="to-arrow" class="hidden text-center text-blue-500 text-sm">‚¨áÔ∏è –ö–£–î–ê ‚¨áÔ∏è</div>
                <select id="acc2" class="hidden w-full p-3 bg-slate-50 rounded-xl font-bold text-center border text-sm"></select>
            </div>
            <div id="cats" class="flex flex-wrap gap-2 justify-center mb-6"></div>
            <button onclick="save()" id="save-btn" class="w-full bg-blue-600 text-white py-5 rounded-2xl font-black shadow-lg">–°–û–•–†–ê–ù–ò–¢–¨</button>
        </div>

        <h3 class="text-[10px] font-black uppercase text-slate-400 mb-3 px-2">–ò—Å—Ç–æ—Ä–∏—è (–ü—Ä–∞–≤–∫–∞ —Å —ç–∫—Ä–∞–Ω–∞)</h3>
        <div id="history" class="space-y-3"></div>
    </div>

    <script>
        const GOOGLE_URL = "–í–ê–®–ê_–ù–û–í–ê–Ø_–°–°–´–õ–ö–ê"; 
        window.mode = 'expense'; window.cat = '–†–∞–∑–Ω–æ–µ'; window.currentRate = 42.5;
        const accounts = {
            sparkasse: {n: 'Sparkasse', c: 'EUR'}, casheur: {n: '–ù–∞–ª EUR', c: 'EUR'},
            uahcard: {n: 'UAH Card', c: 'UAH'}, cashuah: {n: '–ù–∞–ª UAH', c: 'UAH'}
        };

        async function updateRate() {
            try {
                const r = await fetch('https://open.er-api.com/v6/latest/EUR');
                const d = await r.json(); window.currentRate = d.rates.UAH;
                document.getElementById('rates-header').innerText = `–ö—É—Ä—Å —Å–µ–π—á–∞—Å: 1 ‚Ç¨ = ${window.currentRate.toFixed(2)} ‚Ç¥`;
            } catch(e) {}
        }

        function render() {
            const m = window.mode;
            ['exp','inc','tra'].forEach(k => document.getElementById('m-'+k).className = m === (k==='exp'?'expense':k==='inc'?'income':'transfer') ? 'flex-1 py-2 rounded-xl text-[10px] font-bold uppercase bg-white shadow-sm' : 'flex-1 py-2 rounded-xl text-[10px] font-bold uppercase text-slate-400');
            document.getElementById('acc2').classList.toggle('hidden', m!=='transfer');
            document.getElementById('to-arrow').classList.toggle('hidden', m!=='transfer');
            const cats = m==='income' ? ['üí∞ –ó–∞—Ä–ø–ª–∞—Ç–∞', 'üéÅ –ü–æ–¥–∞—Ä–æ–∫', 'üìà –ü—Ä–æ—Ü–µ–Ω—Ç'] : ['üõí –ü—Ä–æ–¥—É–∫—Ç—ã', '‚òï –ö–∞—Ñ–µ', 'üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç', 'üè† –ê—Ä–µ–Ω–¥–∞', 'üíä –ó–¥–æ—Ä–æ–≤—å–µ', 'üõçÔ∏è –®–æ–ø–∏–Ω–≥'];
            document.getElementById('cats').innerHTML = cats.map(c => `<button onclick="window.cat='${c}';render()" class="px-3 py-2 rounded-xl text-[9px] font-bold border ${window.cat===c?'bg-blue-500 text-white border-blue-500':'bg-white text-slate-400'}">${c}</button>`).join('');
            const accSelects = Object.entries(accounts).map(([id, a]) => `<option value="${id}">${a.n} (${a.c})</option>`).join('');
            if(!document.getElementById('acc1').innerHTML) { document.getElementById('acc1').innerHTML = accSelects; document.getElementById('acc2').innerHTML = accSelects; }
        }

        async function save() {
            const amount = parseFloat(document.getElementById('sum').value);
            if(!amount) return; document.getElementById('save-btn').innerText = "–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø...";
            let ops = [];
            if(window.mode === 'transfer') {
                ops.push({type:'expense', amount, account: document.getElementById('acc1').value, category:'‚ôªÔ∏è –ü–µ—Ä–µ–≤–æ–¥', rate: window.currentRate});
                ops.push({type:'income', amount, account: document.getElementById('acc2').value, category:'‚ôªÔ∏è –ü–µ—Ä–µ–≤–æ–¥', rate: window.currentRate});
            } else {
                ops.push({type:window.mode, amount, account: document.getElementById('acc1').value, category:window.cat, rate: window.currentRate});
            }
            for(let op of ops) await fetch(GOOGLE_URL, {method:"POST", mode:"no-cors", body: JSON.stringify(op)});
            location.reload();
        }

        async function deleteItem(id) {
            if(!confirm("–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å?")) return;
            await fetch(GOOGLE_URL, {method:"POST", mode:"no-cors", body: JSON.stringify({action:"delete", id: id})});
            location.reload();
        }

        async function load() {
            const r = await fetch(GOOGLE_URL); const data = await r.json();
            let bals = {sparkasse:0, casheur:0, uahcard:0, cashuah:0}, hist = "";
            data.slice(1).forEach(row => {
                const [type, date, title, desc, amt, cur, cat, acc, rate] = row;
                const val = parseFloat(amt);
                if(bals.hasOwnProperty(acc)) bals[acc] += (type==='income' ? val : -val);
                hist = `<div class="bg-white p-4 rounded-3xl flex justify-between items-center shadow-sm border border-slate-100">
                    <div><p class="font-black text-sm">${cat}</p><p class="text-[9px] text-slate-400 uppercase font-bold">${acc} ‚Ä¢ ${new Date(date).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</p></div>
                    <div class="flex items-center gap-3">
                        <div class="text-right"><p class="font-black ${type==='income'?'text-green-500':'text-red-500'}">${type==='income'?'+':'-'}${val.toFixed(2)}</p><p class="text-[8px] text-slate-300 font-bold">–ö—É—Ä—Å: ${rate || '‚Äî'}</p></div>
                        <button onclick="deleteItem('${date}')" class="text-slate-200">üóëÔ∏è</button>
                    </div>
                </div>` + hist;
            });
            const totalEur = bals.sparkasse + bals.casheur + (bals.uahcard / window.currentRate) + (bals.cashuah / window.currentRate);
            document.getElementById('total-val').innerText = totalEur.toLocaleString(undefined, {minimumFractionDigits:2}) + ' ‚Ç¨';
            document.getElementById('balance-grid').innerHTML = Object.entries(bals).map(([id, v]) => `<div class="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm text-center"><p class="text-[9px] text-slate-400 uppercase font-black mb-1">${accounts[id].n}</p><p class="text-lg font-bold">${v.toFixed(2)} ${accounts[id].c==='EUR'?'‚Ç¨':'‚Ç¥'}</p></div>`).join('');
            document.getElementById('history').innerHTML = hist;
        }
        updateRate().then(load); render();
    </script>
</body>
</html>
