<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Smart Wallet Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .active-tab { background-color: #1d4ed8; color: white; }
        .cat-btn { border: 1px solid #e2e8f0; padding: 6px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; color: #64748b; transition: 0.2s; }
        .cat-btn.selected { background-color: #3b82f6; color: white; border-color: #3b82f6; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 pb-10">
    <div class="max-w-md mx-auto p-4">
        <h1 class="text-2xl font-black italic text-blue-700 mb-6 text-center">SMARTWALLET PRO</h1>

        <div id="balance-grid" class="grid grid-cols-2 gap-3 mb-6">
            </div>

        <div class="flex bg-white p-1 rounded-2xl shadow-sm mb-6 border border-slate-100">
            <button onclick="setMode('expense')" id="tab-expense" class="flex-1 py-3 rounded-xl font-bold text-xs active-tab uppercase">–†–∞—Å—Ö–æ–¥</button>
            <button onclick="setMode('income')" id="tab-income" class="flex-1 py-3 rounded-xl font-bold text-xs text-slate-400 uppercase">–î–æ—Ö–æ–¥</button>
            <button onclick="setMode('transfer')" id="tab-transfer" class="flex-1 py-3 rounded-xl font-bold text-xs text-slate-400 uppercase">–ü–µ—Ä–µ–≤–æ–¥</button>
        </div>

        <div class="bg-white p-6 rounded-[32px] shadow-xl mb-6 border border-slate-100">
            <input id="main-amount" type="number" placeholder="0.00" class="w-full text-5xl font-black text-center outline-none mb-4">
            
            <div id="transfer-logic" class="hidden space-y-3 mb-4">
                <select id="acc-from" class="w-full p-3 bg-slate-50 rounded-xl font-bold text-slate-600 appearance-none text-center border">
                    <option value="">–û–¢–ö–£–î–ê (–°—á–µ—Ç)</option>
                    <option value="sparkasse">Sparkasse</option>
                    <option value="casheur">–ù–∞–ª–∏—á–Ω—ã–µ EUR</option>
                    <option value="uahcard">UAH Card</option>
                    <option value="cashuah">–ù–∞–ª–∏—á–Ω—ã–µ UAH</option>
                </select>
                <div class="text-center text-blue-500">‚¨áÔ∏è</div>
                <select id="acc-to" class="w-full p-3 bg-slate-50 rounded-xl font-bold text-slate-600 appearance-none text-center border">
                    <option value="">–ö–£–î–ê (–°—á–µ—Ç)</option>
                    <option value="sparkasse">Sparkasse</option>
                    <option value="casheur">–ù–∞–ª–∏—á–Ω—ã–µ EUR</option>
                    <option value="uahcard">UAH Card</option>
                    <option value="cashuah">–ù–∞–ª–∏—á–Ω—ã–µ UAH</option>
                </select>
            </div>

            <select id="main-account" class="w-full p-3 bg-slate-50 rounded-xl font-bold text-slate-600 appearance-none text-center mb-4">
                <option value="sparkasse">Sparkasse</option>
                <option value="casheur">–ù–∞–ª–∏—á–Ω—ã–µ EUR</option>
                <option value="uahcard">UAH Card</option>
                <option value="cashuah">–ù–∞–ª–∏—á–Ω—ã–µ UAH</option>
            </select>

            <div id="categories-box" class="flex flex-wrap gap-2 mb-4 justify-center">
                </div>
            
            <button onclick="processAction()" id="action-btn" class="w-full bg-blue-600 text-white py-5 rounded-2xl font-black shadow-lg">–°–û–•–†–ê–ù–ò–¢–¨</button>
        </div>

        <h2 class="text-xs font-black uppercase text-slate-400 mb-4 px-2">–ò—Å—Ç–æ—Ä–∏—è (–ü—Ä–∞–≤–∫–∞ –≤ Google –¢–∞–±–ª–∏—Ü–µ)</h2>
        <div id="history" class="space-y-2"></div>
    </div>

    <script>
        const GOOGLE_URL = "https://script.google.com/macros/s/AKfycbxE8xruU4-l8eCDLA8XzwNo4_Rt30aTnbbq9YWjKWSJuiLzeslS_KYxCaITBPhl3303xQ/exec"; 
        let currentMode = 'expense';
        let selectedCategory = '–†–∞–∑–Ω–æ–µ';
        
        const cats = {
            expense: ['üõí –ü—Ä–æ–¥—É–∫—Ç—ã', '‚òï –ö–∞—Ñ–µ', 'üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç', 'üè† –ê—Ä–µ–Ω–¥–∞', 'üíä –ó–¥–æ—Ä–æ–≤—å–µ', 'üõçÔ∏è –®–æ–ø–∏–Ω–≥'],
            income: ['üí∞ –ó–∞—Ä–ø–ª–∞—Ç–∞', 'üéÅ –ü–æ–¥–∞—Ä–æ–∫', 'üìà –ü—Ä–æ—Ü–µ–Ω—Ç'],
            transfer: ['‚ôªÔ∏è –û–±–º–µ–Ω/–ü–µ—Ä–µ–≤–æ–¥']
        };

        function setMode(mode) {
            currentMode = mode;
            ['expense', 'income', 'transfer'].forEach(m => {
                document.getElementById('tab-'+m).className = m === mode ? 'flex-1 py-3 rounded-xl font-bold text-xs active-tab uppercase' : 'flex-1 py-3 rounded-xl font-bold text-xs text-slate-400 uppercase';
            });
            
            document.getElementById('transfer-logic').classList.toggle('hidden', mode !== 'transfer');
            document.getElementById('main-account').classList.toggle('hidden', mode === 'transfer');
            renderCategories();
        }

        function renderCategories() {
            const box = document.getElementById('categories-box');
            box.innerHTML = cats[currentMode].map(c => `<button onclick="selectedCategory='${c}'; renderCategories()" class="cat-btn ${selectedCategory === c ? 'selected' : ''}">${c}</button>`).join('');
        }

        async function processAction() {
            const amount = parseFloat(document.getElementById('main-amount').value);
            if (!amount) return alert("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É");

            const btn = document.getElementById('action-btn');
            btn.disabled = true;
            btn.innerText = "–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø...";

            let entries = [];
            if (currentMode === 'transfer') {
                const from = document.getElementById('acc-from').value;
                const to = document.getElementById('acc-to').value;
                if (!from || !to) return alert("–í—ã–±–µ—Ä–∏—Ç–µ —Å—á–µ—Ç–∞");
                entries.push({ type: 'expense', amount, account: from, category: '–ü–µ—Ä–µ–≤–æ–¥', title: '–ü–µ—Ä–µ–≤–æ–¥ (–∏—Å—Ö)' });
                entries.push({ type: 'income', amount, account: to, category: '–ü–µ—Ä–µ–≤–æ–¥', title: '–ü–µ—Ä–µ–≤–æ–¥ (–≤—Ö)' });
            } else {
                entries.push({ type: currentMode, amount, account: document.getElementById('main-account').value, category: selectedCategory, title: '–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è' });
            }

            for (let data of entries) {
                await fetch(GOOGLE_URL, { method: "POST", mode: "no-cors", body: JSON.stringify(data) });
            }

            alert("–í—ã–ø–æ–ª–Ω–µ–Ω–æ!");
            location.reload();
        }

        async function loadData() {
            const r = await fetch(GOOGLE_URL);
            const data = await r.json();
            let balances = { sparkasse: 0, casheur: 0, uahcard: 0, cashuah: 0 };
            let historyHTML = "";

            data.slice(1).forEach(row => {
                const [type, date, title, desc, amount, cur, cat, acc] = row;
                const val = parseFloat(amount);
                if (balances.hasOwnProperty(acc)) balances[acc] += (type === 'income' ? val : -val);
                
                historyHTML = `<div class="bg-white p-4 rounded-2xl flex justify-between items-center mb-2 shadow-sm border border-slate-50">
                    <div>
                        <p class="font-black text-slate-700">${cat}</p>
                        <p class="text-[10px] text-slate-400 uppercase font-bold">${acc} ‚Ä¢ ${new Date(date).toLocaleDateString()}</p>
                    </div>
                    <div class="text-right">
                        <p class="font-black ${type === 'income' ? 'text-green-500' : 'text-red-500'}">${type === 'income' ? '+' : '-'}${val}</p>
                        <p class="text-[10px] text-slate-300 font-bold">–û—Å—Ç–∞—Ç–æ–∫: ${balances[acc].toFixed(2)}</p>
                    </div>
                </div>` + historyHTML;
            });

            document.getElementById('balance-grid').innerHTML = Object.entries(balances).map(([name, val]) => `
                <div class="bg-white p-4 rounded-2xl border border-slate-100 shadow-sm">
                    <p class="text-[9px] text-slate-400 uppercase font-black mb-1">${name}</p>
                    <p class="text-lg font-bold">${val.toFixed(2)} ${name.includes('uah') ? '‚Ç¥' : '‚Ç¨'}</p>
                </div>
            `).join('');
            document.getElementById('history').innerHTML = historyHTML;
        }

        document.addEventListener('DOMContentLoaded', () => { renderCategories(); loadData(); });
    </script>
</body>
</html>
