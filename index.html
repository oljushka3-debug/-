// –í–ê–ñ–ù–û: –í—Å—Ç–∞–≤—å —Å–≤–æ—é —Å—Å—ã–ª–∫—É EXEC –∑–¥–µ—Å—å
        const API_URL = "https://script.google.com/macros/s/AKfycbwPMMSe0q9BS7q2wRFmuWwXaQ01xm27B7TFtD_WbJCMe_AhIcgRhqGHrlAgivAQMU1X/exec";

        function isUah(acc) { return acc.includes('–ü—Ä–∏–≤–∞—Ç') || acc.includes('UAH'); }

        // –£–º–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏
        function openModal(type) {
            document.getElementById('txType').value = type;
            document.getElementById('modal').classList.remove('hidden');
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
            
            const isT = type === 'transfer';
            const isInc = type === 'income';
            
            // –ó–∞–≥–æ–ª–æ–≤–æ–∫
            document.getElementById('modalTitle').innerText = isInc ? '–ü–û–ü–û–õ–ù–ï–ù–ò–ï' : (isT ? '–ü–ï–†–ï–í–û–î' : '–†–ê–°–•–û–î');
            
            // –°–∫—Ä—ã–≤–∞–µ–º/–ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–ª–æ–∫–∏
            document.getElementById('standardFields').classList.toggle('hidden', isT);
            document.getElementById('transferFields').classList.toggle('hidden', !isT);
            
            // –ï—Å–ª–∏ —ç—Ç–æ –î–û–•–û–î ‚Äî —Å–∫—Ä—ã–≤–∞–µ–º –ª–∏—à–Ω–∏–µ "–º–∞–≥–∞–∑–∏–Ω–Ω—ã–µ" –ø–æ–ª—è
            document.getElementById('qty').parentElement.classList.toggle('hidden', isInc);
            document.getElementById('itemsGroup')?.classList.toggle('hidden', isInc); 
            // –ï—Å–ª–∏ —É —Ç–µ–±—è –Ω–µ—Ç id="itemsGroup", –¥–æ–±–∞–≤—å –µ–≥–æ –≤ HTML –∫–æ–¥–µ –∫ –±–ª–æ–∫—É —Å –¢–æ–≤–∞—Ä DE/RU
            
            document.getElementById('merchant').placeholder = isInc ? "–ò—Å—Ç–æ—á–Ω–∏–∫ (–ó–∞—Ä–ø–ª–∞—Ç–∞, –ü–æ–¥–∞—Ä–æ–∫...)" : "–ú–∞–≥–∞–∑–∏–Ω / –û–ø–∏—Å–∞–Ω–∏–µ";
            
            if(isT) syncT(); else calcInfo();
        }

        // –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –±–∞–ª–∞–Ω—Å–æ–≤ –∏ –∏—Å—Ç–æ—Ä–∏–∏
        function draw(data) {
            const hist = document.getElementById('history');
            let b = { "Sparkasse": 0, "–ü—Ä–∏–≤–∞—Ç": 0, "–ù–∞–ª–∏—á–Ω—ã–µ EUR": 0, "–ù–∞–ª–∏—á–Ω—ã–µ UAH": 0 };
            hist.innerHTML = ""; // –û—á–∏—Å—Ç–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –ø–µ—Ä–µ–¥ –æ—Ç—Ä–∏—Å–æ–≤–∫–æ–π
            
            if(!data.rows) return;
            
            // –ü—Ä–æ—Ö–æ–¥–∏–º –ø–æ –≤—Å–µ–º —Å—Ç—Ä–æ–∫–∞–º —Ç–∞–±–ª–∏—Ü—ã
            data.rows.forEach((r) => {
                const trAmt = parseFloat(r[8]) || 0; // –°—É–º–º–∞ EUR
                const crAmt = parseFloat(r[10]) || 0; // –°—É–º–º–∞ UAH
                const acc = r[5];
                const cat = String(r[1]); // –ö–∞—Ç–µ–≥–æ—Ä–∏—è
                const isDel = String(r[3]).includes("[–£–î–ê–õ–ï–ù–û]");

                if (!isDel && b.hasOwnProperty(acc)) {
                    // –ï—Å–ª–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç "–î–æ—Ö–æ–¥" –∏–ª–∏ "üíé" ‚Äî —ç—Ç–æ –ü–õ–Æ–°
                    const isIncome = cat.includes('–î–æ—Ö–æ–¥') || cat.includes('üíé');
                    let val = isUah(acc) ? Math.abs(crAmt) : Math.abs(trAmt);
                    
                    if (isIncome) b[acc] += val; 
                    else b[acc] -= val;
                }
            });

            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 10 –∑–∞–ø–∏—Å–µ–π –≤ –∏—Å—Ç–æ—Ä–∏—é (—Ä–µ–≤–µ—Ä—Å –¥–ª—è –ø–æ–∫–∞–∑–∞ –Ω–æ–≤—ã—Ö —Å–≤–µ—Ä—Ö—É)
            data.rows.slice().reverse().slice(0, 10).forEach((r) => {
                const trAmt = parseFloat(r[8]) || 0;
                const crAmt = parseFloat(r[10]) || 0;
                const acc = r[5];
                const cat = r[1];
                const isIncome = cat.includes('–î–æ—Ö–æ–¥') || cat.includes('üíé');
                const isU = isUah(acc);
                const displaySum = Math.abs(isU ? crAmt : trAmt).toFixed(2);

                hist.innerHTML += `
                    <div class="bg-slate-900/40 p-3 rounded-2xl flex justify-between items-center border border-slate-800 text-[10px] mb-1">
                        <div>
                            <p class="text-slate-600 font-black uppercase">${r[0].split('T')[0].substring(5)} | ${acc}</p>
                            <p class="font-bold text-slate-200 text-xs">${r[2]}</p>
                        </div>
                        <div class="text-right text-xs font-black ${isIncome ? 'text-emerald-500' : 'text-rose-500'}">
                            ${isIncome ? '+' : '-'}${displaySum} ${isU ? '‚Ç¥' : '‚Ç¨'}
                        </div>
                    </div>`;
            });

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–æ–≤ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
            for(let k in b) {
                const el = document.getElementById('acc-'+k);
                if(el) el.innerText = (isUah(k) ? '‚Ç¥ ' : '‚Ç¨ ') + b[k].toFixed(2);
            }

            // –û–±—â–∏–π –∫–∞–ø–∏—Ç–∞–ª
            const rate = parseFloat(document.getElementById('rate').value) || 50.76;
            globalBalance = b["Sparkasse"] + b["–ù–∞–ª–∏—á–Ω—ã–µ EUR"] + (b["–ü—Ä–∏–≤–∞—Ç"] + b["–ù–∞–ª–∏—á–Ω—ã–µ UAH"]) / rate;
            document.getElementById('mainBalance').innerText = '‚Ç¨ ' + globalBalance.toFixed(2);
            
            checkLimit();
        }
