<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Smart Wallet Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; color: #1e293b; padding-bottom: 40px; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .item-row { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        input, select { -webkit-appearance: none; outline: none; }
    </style>
</head>
<body>

    <div class="max-w-md mx-auto px-5 pt-6">
        <header class="flex justify-between items-center mb-6 text-left">
            <div>
                <h1 class="text-2xl font-black italic uppercase">Smart<span class="text-indigo-600">Wallet</span></h1>
                <p class="text-[10px] font-bold opacity-40">ДЕТАЛИЗАЦИЯ ПОКУПОК ВКЛЮЧЕНА</p>
            </div>
            <button onclick="location.reload()" class="p-3 bg-white rounded-2xl border shadow-sm"><i data-lucide="refresh-cw" class="w-5 h-5 text-indigo-600"></i></button>
        </header>

        <div class="bg-white rounded-[2.5rem] p-6 shadow-xl border border-slate-100 text-left">
            <div class="mb-6">
                <label class="text-[10px] font-black text-slate-400 ml-2 uppercase">Где покупаем?</label>
                <input type="text" id="mainStore" placeholder="Lidl, Aldi, DM..." class="w-full p-4 bg-slate-50 rounded-2xl border-none font-bold text-lg mt-1 focus:ring-2 ring-indigo-100">
            </div>

            <div class="space-y-3 mb-6">
                <label class="text-[10px] font-black text-slate-400 ml-2 uppercase">Список товаров (чек)</label>
                <div id="itemsContainer" class="space-y-2">
                    </div>
                
                <button onclick="addItemRow()" class="w-full py-3 border-2 border-dashed border-slate-200 rounded-2xl text-slate-400 font-bold text-xs uppercase hover:border-indigo-300 hover:text-indigo-400 transition-all flex items-center justify-center gap-2">
                    <i data-lucide="plus-circle" class="w-4 h-4"></i> Добавить товар в чек
                </button>
            </div>

            <div class="grid grid-cols-2 gap-4 pt-4 border-t">
                <div>
                    <label class="text-[10px] font-black text-slate-400 ml-2 uppercase">ИТОГО ПО ЧЕКУ</label>
                    <div id="totalDisplay" class="text-3xl font-black text-indigo-600 mt-1">0.00 €</div>
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 ml-2 uppercase">Счет списания</label>
                    <select id="accFrom" class="w-full p-4 bg-slate-50 rounded-2xl font-bold text-xs mt-1">
                        <option value="Sparkasse">Sparkasse</option>
                        <option value="Приват">Приват (UAH)</option>
                        <option value="Наличные EUR">Наличные EUR</option>
                    </select>
                </div>
            </div>

            <button onclick="submitCheck()" class="w-full mt-6 py-5 bg-slate-900 text-white rounded-2xl font-black uppercase text-[11px] tracking-widest shadow-lg active:scale-95 transition-all">
                Записать весь чек
            </button>
        </div>
    </div>

    <script>
        let items = [];

        function addItemRow() {
            const id = Date.now();
            const html = `
                <div id="row-${id}" class="item-row flex gap-2 items-center bg-slate-50 p-2 rounded-xl">
                    <input type="text" placeholder="Товар" class="name flex-1 bg-transparent p-2 font-bold text-sm outline-none" oninput="updateItem(${id})">
                    <input type="number" placeholder="1.20" class="price w-16 bg-white rounded-lg p-2 text-xs font-bold shadow-sm" oninput="updateItem(${id})" step="0.01">
                    <span class="text-[10px] font-black opacity-30">X</span>
                    <input type="number" placeholder="1" class="qty w-10 bg-white rounded-lg p-2 text-xs font-bold shadow-sm" oninput="updateItem(${id})">
                    <button onclick="removeRow(${id})" class="p-2 text-rose-400"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                </div>
            `;
            document.getElementById('itemsContainer').insertAdjacentHTML('beforeend', html);
            lucide.createIcons();
        }

        function updateItem(id) {
            calculateTotal();
        }

        function removeRow(id) {
            document.getElementById(`row-${id}`).remove();
            calculateTotal();
        }

        function calculateTotal() {
            let total = 0;
            const rows = document.querySelectorAll('.item-row');
            rows.forEach(row => {
                const p = parseFloat(row.querySelector('.price').value) || 0;
                const q = parseFloat(row.querySelector('.qty').value) || 0;
                total += p * q;
            });
            document.getElementById('totalDisplay').innerText = total.toFixed(2) + ' €';
        }

        function submitCheck() {
            const store = document.getElementById('mainStore').value;
            if (!store) return alert("Введите название магазина!");
            
            let details = [];
            let grandTotal = 0;
            
            document.querySelectorAll('.item-row').forEach(row => {
                const n = row.querySelector('.name').value;
                const p = row.querySelector('.price').value;
                const q = row.querySelector('.qty').value;
                if(n && p) {
                    details.push(`${n} (${q}x${p})`);
                    grandTotal += (parseFloat(p) * parseFloat(q));
                }
            });

            const finalData = {
                store: store,
                total: grandTotal.toFixed(2),
                comment: details.join(', '), // Это запишется в примечание
                account: document.getElementById('accFrom').value
            };

            console.log("Отправляем в Google:", finalData);
            alert(`Готово! В таблицу пойдет:\nМагазин: ${store}\nСумма: ${grandTotal.toFixed(2)} €\nСостав: ${finalData.comment}`);
        }

        // Добавим одну пустую строку сразу
        window.onload = () => { addItemRow(); lucide.createIcons(); };
    </script>
</body>
</html>
