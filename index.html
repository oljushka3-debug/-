<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>SmartWallet v15.9</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-slate-950 text-slate-100 p-4 pb-10">

<div class="bg-gradient-to-br from-slate-900 to-slate-800 p-5 rounded-[30px] border border-slate-700/50 mb-4 shadow-2xl">
<div class="flex justify-between items-center mb-3 text-[10px] font-bold opacity-60 uppercase italic">
<span>–ö—É—Ä—Å: <input type="number" id="baseRate" value="50.76" step="0.01" oninput="drawBalance()" class="w-10 bg-transparent text-yellow-500 outline-none font-black"></span>
<span id="currentMonth">–ú–ï–°–Ø–¶</span>
</div>
<h1 id="mainBalance" class="text-center text-4xl font-black italic mb-4 tracking-tighter">‚Ç¨ 0.00</h1>
<div class="grid grid-cols-2 gap-2 text-[9px] font-bold uppercase italic text-center text-white">
<div class="bg-slate-800/40 p-2 rounded-xl border border-blue-500/10 text-blue-400">Sparkasse: <span id="acc-Sparkasse" class="block text-white text-xs mt-1 font-black italic">‚Ç¨ 0.00</span></div>
<div class="bg-slate-800/40 p-2 rounded-xl border border-green-500/10 text-green-500">–ü—Ä–∏–≤–∞—Ç: <span id="acc-–ü—Ä–∏–≤–∞—Ç" class="block text-white text-xs mt-1 font-black italic">‚Ç¥ 0.00</span></div>
<div class="bg-slate-800/40 p-2 rounded-xl border border-yellow-500/10 text-yellow-500">–ù–∞–ª ‚Ç¨: <span id="acc-–ù–∞–ª–∏—á–Ω—ã–µ EUR" class="block text-white text-xs mt-1 font-black italic">‚Ç¨ 0.00</span></div>
<div class="bg-slate-800/40 p-2 rounded-xl border border-orange-500/10 text-orange-500">–ù–∞–ª ‚Ç¥: <span id="acc-–ù–∞–ª–∏—á–Ω—ã–µ UAH" class="block text-white text-xs mt-1 font-black italic">‚Ç¥ 0.00</span></div>
</div>
</div>

<div id="limitsBlock" class="bg-slate-900/80 p-5 rounded-[30px] border border-slate-800 mb-6 space-y-4">
<h3 class="text-[10px] font-black uppercase text-slate-500 tracking-[0.2em] mb-2 italic text-center">–ö–æ–Ω—Ç—Ä–æ–ª—å –±—é–¥–∂–µ—Ç–∞</h3>
<div id="limit-items" class="space-y-4"></div>
</div>

<div class="flex gap-2 mb-8 font-black">
<button onclick="openModal('expense')" class="flex-1 bg-rose-600 py-4 rounded-2xl text-[10px] uppercase border-b-4 border-rose-900 active:scale-95 shadow-lg">–†–∞—Å—Ö–æ–¥</button>
<button onclick="openModal('transfer')" class="flex-1 bg-slate-700 py-4 rounded-2xl text-[10px] uppercase border-b-4 border-slate-900 text-white shadow-lg">–ü–µ—Ä–µ–≤–æ–¥</button>
<button onclick="openModal('income')" class="flex-1 bg-emerald-600 py-4 rounded-2xl text-[10px] uppercase border-b-4 border-emerald-900 active:scale-95 shadow-lg">–î–æ—Ö–æ–¥</button>
</div>

<div id="history" class="space-y-2"></div>

<div id="modal" class="fixed inset-0 bg-black/95 hidden flex items-center justify-center p-4 z-50">
<div class="bg-slate-900 w-full max-w-sm rounded-[45px] p-8 border border-slate-800 shadow-2xl overflow-y-auto max-h-[95vh]">
<h2 id="modalTitle" class="text-2xl font-black text-yellow-500 mb-6 italic uppercase text-center">–ó–∞–ø–∏—Å—å</h2>
<form onsubmit="save(event)" class="space-y-4 text-white">
<input type="hidden" id="txType">
<input type="date" id="date" class="w-full bg-slate-800 p-4 rounded-2xl font-bold outline-none border border-slate-700">

<div id="standardFields" class="space-y-4">
<div class="grid grid-cols-2 gap-2 text-white">
<div class="bg-slate-800 p-3 rounded-2xl"><label class="text-[8px] text-slate-500 block uppercase mb-1">–ö–æ–ª-–≤–æ</label><input type="number" id="qty" value="1" class="w-full bg-transparent text-xl font-bold outline-none"></div>
<div class="bg-slate-800 p-3 rounded-2xl border-2 border-slate-700 text-center"><label class="text-[8px] text-blue-400 block uppercase mb-1 font-black italic">–°—É–º–º–∞</label><input type="number" id="price" step="0.01" class="w-full bg-transparent text-xl font-bold outline-none text-center font-black"></div>
</div>
</div>

<div id="transferFields" class="hidden space-y-4">
<div class="grid grid-cols-2 gap-2 text-[10px] uppercase font-bold text-white">
<select id="tFrom" onchange="syncT()" class="bg-slate-800 p-3 rounded-xl border border-slate-700"><option value="Sparkasse">–ò–∑ Sparkasse</option><option value="–ü—Ä–∏–≤–∞—Ç">–ò–∑ –ü—Ä–∏–≤–∞—Ç</option><option value="–ù–∞–ª–∏—á–Ω—ã–µ EUR">–ò–∑ –ù–∞–ª ‚Ç¨</option><option value="–ù–∞–ª–∏—á–Ω—ã–µ UAH">–ò–∑ –ù–∞–ª ‚Ç¥</option></select>
<select id="tTo" onchange="syncT()" class="bg-slate-800 p-3 rounded-xl border border-slate-700 text-yellow-500"><option value="–ù–∞–ª–∏—á–Ω—ã–µ EUR">–í –ù–∞–ª ‚Ç¨</option><option value="–ü—Ä–∏–≤–∞—Ç">–í –ü—Ä–∏–≤–∞—Ç</option><option value="Sparkasse">–í Sparkasse</option><option value="–ù–∞–ª–∏—á–Ω—ã–µ UAH">–í –ù–∞–ª ‚Ç¥</option></select>
</div>
<div class="bg-slate-800 p-5 rounded-3xl border border-yellow-500/20 text-center shadow-inner font-black">
<input type="number" id="tAmountFrom" step="0.01" oninput="syncT('from')" class="w-full bg-transparent text-3xl font-black outline-none mb-3 text-white" placeholder="0.00">
<div class="border-t border-slate-700 my-2 opacity-30"></div>
<input type="number" id="tAmountTo" step="0.01" oninput="syncT('to')" class="w-full bg-transparent text-3xl font-black outline-none text-yellow-500 mt-2" placeholder="0.00">
</div>
</div>

<input type="text" id="merchant" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" class="w-full bg-slate-800 p-4 rounded-2xl outline-none font-bold border border-slate-700 text-white">

<div id="accCatGroup" class="grid grid-cols-2 gap-2">
<select id="acc" class="bg-slate-800 p-4 rounded-2xl font-bold text-xs outline-none border border-slate-700 text-white"><option value="Sparkasse">Sparkasse</option><option value="–ü—Ä–∏–≤–∞—Ç">–ü—Ä–∏–≤–∞—Ç</option><option value="–ù–∞–ª–∏—á–Ω—ã–µ EUR">–ù–∞–ª ‚Ç¨</option><option value="–ù–∞–ª–∏—á–Ω—ã–µ UAH">–ù–∞–ª ‚Ç¥</option></select>
<select id="cat" class="bg-slate-800 p-4 rounded-2xl font-bold text-xs outline-none border border-slate-700 text-white">
<option value="üîÑ –ü–µ—Ä–µ–≤–æ–¥">üîÑ –ü–µ—Ä–µ–≤–æ–¥</option>
<option>üçé –ü—Ä–æ–¥—É–∫—Ç—ã / –ë—ã—Ç</option>
<option>üö¨ –¢–∞–±–∞–∫ / –û—Ç–¥—ã—Ö</option>
<option>üè† –ñ–∏–ª—å–µ / –°—á–µ—Ç–∞</option>
<option>üíä –ó–¥–æ—Ä–æ–≤—å–µ</option>
<option>üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</option>
<option>üõç –û—Å—Ç–∞–ª—å–Ω–æ–µ</option>
<option value="üíé –î–æ—Ö–æ–¥">üíé –î–æ—Ö–æ–¥</option>
</select>
</div>

<div class="flex gap-2 pt-2">
<button type="button" onclick="closeModal()" class="flex-1 bg-slate-800 text-slate-400 py-4 rounded-2xl font-bold uppercase text-[10px]">–û—Ç–º–µ–Ω–∞</button>
<button id="saveBtn" class="flex-[2] bg-yellow-500 text-black py-4 rounded-2xl font-black uppercase text-lg border-b-4 border-yellow-700">OK</button>
</div>
</form>
</div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwYOqUZS81ubnLzWagEBKL78B8mPm7rnUzPrWqtpMXCJDcn8qbx2u-gAWP_hhsG28Da/exec";

const MY_LIMITS = {
üçé –ü—Ä–æ–¥—É–∫—Ç—ã / –ë—ã—Ç: 350, "üè† –ñ–∏–ª—å–µ / –°—á–µ—Ç–∞": 50, "üö¨ –¢–∞–±–∞–∫ / –û—Ç–¥—ã—Ö": 100, "üíä –ó–¥–æ—Ä–æ–≤—å–µ": 80, "üöó –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç": 70, "üõç –û—Å—Ç–∞–ª—å–Ω–æ–µ": 50
};

let walletData = { "Sparkasse": 0, "–ü—Ä–∏–≤–∞—Ç": 0, "–ù–∞–ª–∏—á–Ω—ã–µ EUR": 0, "–ù–∞–ª–∏—á–Ω—ã–µ UAH": 0 };
let spentThisMonth = {};

function isUah(acc) { return acc && (acc.includes('–ü—Ä–∏–≤–∞—Ç') || acc.includes('UAH')); }

function drawLimits() {
const container = document.getElementById('limit-items'); container.innerHTML = "";
for (let cat in MY_LIMITS) {
const spent = Math.abs(spentThisMonth[cat] || 0), limit = MY_LIMITS[cat], percent = Math.min((spent / limit) * 100, 100);
let color = "bg-emerald-500"; if (percent > 75) color = "bg-yellow-500"; if (percent > 95) color = "bg-rose-500";
container.innerHTML += `<div><div class="flex justify-between text-[10px] font-bold mb-1 italic"><span>${cat}</span><span class="${spent > limit ? 'text-rose-500' : 'text-slate-400'} font-black italic text-[10px]">${spent.toFixed(0)} / ${limit} ‚Ç¨</span></div><div class="w-full bg-slate-800 h-1.5 rounded-full overflow-hidden"><div class="${color} h-full transition-all duration-1000" style="width: ${percent}%"></div></div></div>`;
}
}

function drawBalance() {
const r = parseFloat(document.getElementById('baseRate').value) || 50.76;
for(let k in walletData) {
const el = document.getElementById('acc-'+k);
if(el) el.innerText = (isUah(k) ? '‚Ç¥ ' : '‚Ç¨ ') + walletData[k].toFixed(2);
}
const total = walletData["Sparkasse"] + walletData["–ù–∞–ª–∏—á–Ω—ã–µ EUR"] + (walletData["–ü—Ä–∏–≤–∞—Ç"] + walletData["–ù–∞–ª–∏—á–Ω—ã–µ UAH"]) / r;
document.getElementById('mainBalance').innerText = '‚Ç¨ ' + total.toFixed(2);
}

function draw(data) {
const hist = document.getElementById('history'); hist.innerHTML = "";
walletData = { "Sparkasse": 0, "–ü—Ä–∏–≤–∞—Ç": 0, "–ù–∞–ª–∏—á–Ω—ã–µ EUR": 0, "–ù–∞–ª–∏—á–Ω—ã–µ UAH": 0 };
spentThisMonth = {}; const now = new Date();
data.rows.forEach(r => {
const acc = r[5], eur = parseFloat(r[8] || 0), date = new Date(r[0]), cat = r[1], uahVal = parseFloat(r[10] || 0);
if (walletData.hasOwnProperty(acc)) walletData[acc] += (isUah(acc) ? uahVal : eur);
if (date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear() && eur < 0 && !cat.includes("–ü–µ—Ä–µ–≤–æ–¥")) {
const lCat = MY_LIMITS.hasOwnProperty(cat) ? cat : "üõç –û—Å—Ç–∞–ª—å–Ω–æ–µ";
spentThisMonth[lCat] = (spentThisMonth[lCat] || 0) + eur;
}
});
data.rows.slice().reverse().slice(0, 15).forEach(r => {
const acc = r[5], isU = isUah(acc), val = Math.abs(isU ? r[10] : r[8]), isInc = (isU ? r[10] : r[8]) > 0;
hist.innerHTML += `<div class="bg-slate-900/40 p-3 rounded-2xl flex justify-between items-center border border-slate-800 mb-2"><div><p class="text-[8px] text-slate-600 font-bold uppercase italic">${r[0].split('T')[0].substring(5)} | ${acc}</p><p class="text-white text-[11px] font-bold">${r[2]}</p></div><div class="text-right"><div class="font-black text-[11px] ${isInc?'text-emerald-500':'text-rose-500'} italic">${isInc?'+':'-'}${val.toFixed(2)} ${isU?'‚Ç¥':'‚Ç¨'}</div></div></div>`;
});
drawBalance(); drawLimits();
}

async function save(e) {
e.preventDefault();
const btn = document.getElementById('saveBtn'); btn.disabled = true; btn.innerText = "‚è≥...";
const type = document.getElementById('txType').value, rate = parseFloat(document.getElementById('baseRate').value), date = document.getElementById('date').value || new Date().toISOString().split('T')[0];
let payload = { action: 'add', date: date, rate: rate, merchant: document.getElementById('merchant').value };

if(type === 'transfer') {
const fAcc = document.getElementById('tFrom').value, tAcc = document.getElementById('tTo').value;
const amF = parseFloat(document.getElementById('tAmountFrom').value) || 0, amT = parseFloat(document.getElementById('tAmountTo').value) || 0;
payload.category = "üîÑ –ü–µ—Ä–µ–≤–æ–¥"; payload.account = fAcc; payload.targetAcc = tAcc;
payload.priceUnit = ""; payload.curTran = "EUR"; payload.totalTran = amT;
if (isUah(fAcc)) { payload.totalCard = -amF; payload.curCard = "UAH"; }
else if (isUah(tAcc)) { payload.totalCard = amF; payload.curCard = "UAH"; }
else { payload.totalCard = ""; payload.curCard = ""; }
} else {
const p = parseFloat(document.getElementById('price').value) || 0, acc = document.getElementById('acc').value, cat = document.getElementById('cat').value;
const isInc = (type === 'income' || cat.includes('–î–æ—Ö–æ–¥'));
payload.category = cat; payload.account = acc; payload.curTran = "EUR";
if (isInc) {
payload.qty = ""; payload.priceUnit = "";
if (isUah(acc)) {
payload.totalCard = p; payload.curCard = "UAH"; payload.totalTran = p / rate;
} else {
payload.totalTran = p; payload.totalCard = ""; payload.curCard = "";
}
} else {
const q = parseFloat(document.getElementById('qty').value) || 1;
payload.qty = q; payload.priceUnit = p; payload.totalTran = -(q * p);
if (isUah(acc)) { payload.totalCard = -(q * p * rate); payload.curCard = "UAH"; }
else { payload.totalCard = ""; payload.curCard = ""; }
}
}
await fetch(API_URL, { method: 'POST', body: JSON.stringify(payload) });
location.reload();
}

function syncT(origin) {
const from = document.getElementById('tFrom').value, to = document.getElementById('tTo').value, r = parseFloat(document.getElementById('baseRate').value);
let f = parseFloat(document.getElementById('tAmountFrom').value) || 0, t = parseFloat(document.getElementById('tAmountTo').value) || 0;
if (origin === 'from' || !origin) { t = (!isUah(from) && isUah(to)) ? f * r : (isUah(from) && !isUah(to) ? f / r : f); document.getElementById('tAmountTo').value = t.toFixed(2); }
else { f = (!isUah(from) && isUah(to)) ? t / r : (isUah(from) && !isUah(to) ? t * r : t); document.getElementById('tAmountFrom').value = f.toFixed(2); }
}

function openModal(type) {
document.getElementById('txType').value = type; document.getElementById('modal').classList.remove('hidden');
const isT = type === 'transfer', isInc = type === 'income';
document.getElementById('standardFields').classList.toggle('hidden', isT);
document.getElementById('transferFields').classList.toggle('hidden', !isT);
document.getElementById('accCatGroup').classList.toggle('hidden', isT);
if(isT) document.getElementById('cat').value = "üîÑ –ü–µ—Ä–µ–≤–æ–¥";
else if(isInc) document.getElementById('cat').value = "üíé –î–æ—Ö–æ–¥";
else document.getElementById('cat').value = "üçé –ü—Ä–æ–¥—É–∫—Ç—ã / –ë—ã—Ç";
}
function closeModal() { document.getElementById('modal').classList.add('hidden'); }
window.onload = () => { const t = new Date().getTime(); const s = document.createElement('script'); s.src = `${API_URL}?callback=draw&_t=${t}`; document.body.appendChild(s); };
</script>
</body>
</html> 
